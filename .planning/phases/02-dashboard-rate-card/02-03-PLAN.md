---
phase: 02-dashboard-rate-card
plan: 03
type: execute
---

<objective>
Build the Historical Rate Analysis page — a searchable, sortable table of labor roles with rate ranges, GL codes, and expandable detail rows.

Purpose: Deliver a discovery output showing what rates DriveShop has actually charged historically across 30 labor roles. This is the simplest of the three views — basic-but-clean.
Output: Searchable/sortable historical rate table with expandable rows showing unit/cost rate breakdowns.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior summaries:
@.planning/phases/01-foundation/01-03-SUMMARY.md
@.planning/phases/02-dashboard-rate-card/02-01-SUMMARY.md
@.planning/phases/02-dashboard-rate-card/02-02-SUMMARY.md

# Key source files:
@src/pages/RateCardPage.tsx
@src/types/rate-card.ts
@src/lib/data.ts
@src/data/rate-card.json

**Tech stack available:** Vite 7, React 19, TypeScript, Tailwind CSS v4, shadcn/ui v4 (table, input, badge, card), lucide-react
**Established patterns:** @/ path alias, oklch color space, typed JSON imports, data accessor functions, shadcn/ui Table pattern from dashboard tabs
**Constraining decisions:**
- Pre-computed JSON data only
- Enterprise aesthetic: clean, professional table-first design
- Use existing shadcn/ui components (Table, Input, Badge, Card)
- This is the "basic-but-clean" view per PROJECT.md priority order
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build searchable/sortable rate card table</name>
  <files>src/pages/RateCardPage.tsx</files>
  <action>
Replace the RateCardPage stub with the full Historical Rate Analysis page. Use `getRateCard()` data accessor.

**Historical Rate Analysis content:**

1. **Header section**: "Historical Rate Analysis" title with description "136 unique roles and rate ranges extracted from 1,659 historical estimates." Use Card wrapper with CardHeader.

2. **Search bar**: shadcn/ui Input with Search icon (lucide-react) for filtering roles by name. Filter is case-insensitive substring match on role name. Use `useState` for search term. Place above the table, full width.

3. **Summary stats row** (3 small cards inline): Total Roles (count), Most Used Role (role with highest occurrences — display name + count), Roles with OT Variant (count of roles where has_ot_variant is true).

4. **Rate Card Table** — shadcn/ui Table with columns:
   - Role Name (bold, primary text)
   - GL Code(s) — Badge component for each GL code
   - Occurrences — number with subtle bar indicator (width proportional to max occurrences)
   - Unit Rate Range — "$min - $max" formatted, with avg in muted text below
   - Cost Rate Range — "$min - $max" formatted, with avg in muted text below
   - OT — Badge "OT" in accent color if has_ot_variant, empty otherwise
   - Expand chevron (ChevronDown icon from lucide-react)

5. **Sorting**: Add `useState` for sort state `{ key: string, direction: 'asc' | 'desc' }`. Clickable column headers for: Role Name (alpha), Occurrences (numeric), Unit Rate Avg (numeric), Cost Rate Avg (numeric). Show sort direction indicator (ChevronUp/ChevronDown from lucide-react) on active sort column. Default sort: occurrences descending.

6. **Expandable rows**: When clicking a row (or the expand chevron), toggle an expanded detail section below that row. Use `useState<string | null>` for expanded role name.

**Expanded row content:**
- 2-column layout inside the expanded area
- Left column: "Unit Rate Details" — show min, max, avg, median with labels. Use a simple visual range bar: a horizontal bar showing min-to-max range with avg marker. Implement with Tailwind div widths (calculate percentage positions relative to 0-to-max scale).
- Right column: "Cost Rate Details" — same layout as unit rate
- Below: "Found in X events" text, GL codes listed, OT variant status

Format all dollar values with `$` prefix and 2 decimal places using toLocaleString. Use alternating row backgrounds (`even:bg-muted/50`) for the main table. Expanded row background: `bg-muted/30` with left border accent (`border-l-4 border-primary`).

Keep all code in RateCardPage.tsx. No separate component files.
  </action>
  <verify>npm run build succeeds. Dev server shows Historical Rate Analysis with search input, 3 summary cards, sortable table with 30 roles, and expandable detail rows.</verify>
  <done>Historical Rate Analysis shows: search input filtering roles, 3 summary stat cards, sortable 30-row table with GL code badges and OT indicators, clickable column headers with sort direction indicators, expandable detail rows with unit/cost rate ranges and visual range bars. All data from getRateCard().</done>
</task>

<task type="auto">
  <name>Task 2: Polish rate card visual details</name>
  <files>src/pages/RateCardPage.tsx</files>
  <action>
Refine the Historical Rate Analysis with these presentation details:

1. **Occurrence frequency bar**: In the Occurrences column, add a subtle horizontal bar behind/below the number. Bar width = (occurrences / maxOccurrences) * 100%. Use `bg-primary/20` for the bar, height 4px, rounded. This gives an instant visual sense of which roles are most common.

2. **Rate range formatting**: Ensure consistent formatting — "$200.29 - $349.57" with `avg: $277.99`. If min equals max (unlikely but handle it), show just the single value.

3. **Empty state**: When search yields no results, show a centered "No roles match your search" message with muted styling.

4. **Keyboard accessibility**: Ensure rows are keyboard-navigable. Add `tabIndex={0}` and `onKeyDown` handler (Enter/Space to toggle expansion) to each table row.

5. **Smooth expand/collapse**: Add a CSS transition on the expanded detail section. Use `overflow-hidden` with `max-height` transition, or simpler: just a clean mount/unmount with `transition-all duration-200` on the row container. Keep it simple — a basic height animation or just instant show/hide if animation is complex.

6. **Search debounce**: Not needed for 30 rows — instant filtering is fine.

7. **Overall layout consistency**: Ensure the Rate Card page visual weight matches the Dashboard page — same Card padding, same header spacing, same muted-foreground text color for descriptions.
  </action>
  <verify>npm run build succeeds. Search filtering works with empty state. Occurrence bars render proportionally. Row expansion is keyboard accessible (Enter/Space). Rate formatting is consistent.</verify>
  <done>Historical Rate Analysis polished: occurrence frequency bars visible, rate ranges consistently formatted, empty search state shown, rows keyboard-accessible, visual consistency with dashboard. Phase 2 complete.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] `npm run lint` passes (or only pre-existing warnings)
- [ ] Rate Card page: search input filters roles
- [ ] Rate Card page: column headers sort (role, occurrences, unit rate avg, cost rate avg)
- [ ] Rate Card page: clicking row expands detail view with rate ranges
- [ ] Rate Card page: occurrence frequency bars render proportionally
- [ ] Rate Card page: keyboard navigation works (Tab to row, Enter/Space to expand)
- [ ] Rate Card page: empty search state displays correctly
- [ ] No console errors in browser
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript errors
- Historical Rate Analysis fully functional with search, sort, expand
- Visual quality matches enterprise aesthetic from Dashboard
- Phase 2 complete: Dashboard (4 tabs) + Historical Rate Analysis all functional
  </success_criteria>

<output>
After completion, create `.planning/phases/02-dashboard-rate-card/02-03-SUMMARY.md`:

# Phase 2 Plan 03: Historical Rate Analysis Summary

**[Substantive one-liner]**

## Accomplishments
## Files Created/Modified
## Decisions Made
## Issues Encountered

## Next Step
Phase 2 complete, ready for Phase 3: AI Scoping Assistant
</output>
