---
phase: 02-dashboard-rate-card
plan: 02
type: execute
---

<objective>
Build the Bid vs Actual Variance and Event Manager Performance tabs to complete the 4-tab Historical Intelligence Dashboard.

Purpose: Deliver variance analysis showing bid accuracy patterns and a manager performance leaderboard — the operational intelligence views.
Output: Variance tab with section/client/office variance charts and top events table. Manager Performance tab with sortable leaderboard table.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior summaries:
@.planning/phases/01-foundation/01-03-SUMMARY.md
@.planning/phases/02-dashboard-rate-card/02-01-SUMMARY.md

# Key source files:
@src/pages/DashboardPage.tsx
@src/types/dashboard.ts
@src/lib/data.ts
@src/data/dashboard-variance.json
@src/data/dashboard-managers.json

**Tech stack available:** Vite 7, React 19, TypeScript, Tailwind CSS v4, shadcn/ui v4, Recharts, lucide-react
**Established patterns:** @/ path alias, oklch color space, typed JSON imports, data accessor functions, Recharts chart patterns from 02-01, Card-wrapped chart layout
**Constraining decisions:**
- Follow same chart styling patterns established in 02-01 (Card wrappers, ResponsiveContainer, chart-1 through chart-5 colors)
- Pre-computed JSON data only — no raw source file imports
- All code in DashboardPage.tsx (presentation prototype, not production)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build Bid vs Actual Variance tab</name>
  <files>src/pages/DashboardPage.tsx</files>
  <action>
Replace the "variance" tab placeholder with the Bid vs Actual Variance view. Use `getVarianceData()` data accessor.

**Variance tab content:**

1. **KPI row** (3 cards): Events Analyzed (from summary.count — 997), Average Variance (summary.avgVariancePct formatted as "+X.X%"), Median Variance (summary.medianVariancePct formatted as "+X.X%"). Color the variance percentages — positive values in `text-red-500` (over budget), negative in `text-emerald-600` (under budget).

2. **Variance by Section** — Horizontal BarChart showing avgVariancePct per section. Bars color-coded: positive variance (over budget) in chart-5 (warm/orange), negative in chart-2 (emerald). Use `getVarianceData().bySection`. Show percentage labels on bars.

3. **Variance by Client** (top 15) — Horizontal BarChart showing avgVariancePct per client, sorted by absolute variance descending, take top 15. Same color coding as section chart. Use `getVarianceData().byClient`.

4. **Variance by Office** — Horizontal BarChart showing avgVariancePct per office. Same color coding. Use `getVarianceData().byOffice`.

5. **Top 50 Variance Events** — shadcn/ui Table showing the 50 events with largest absolute variance. Columns: Event Name, Client, Office, Bid ($), Actual ($), Variance ($), Variance (%). Format dollar values with toLocaleString. Color variance column: positive values (over budget) in `text-red-500` with "+" prefix, negative (under budget) in `text-emerald-600`. Sort by absolute variancePct descending (already sorted in data). Use `getVarianceData().events`.

Layout: KPIs across top, then section variance (full width), then 2-column grid (client variance left, office variance right), then full-width events table below.

Same Recharts patterns as 02-01. Bar chart heights: 300px for section, 400px for client (15 items), 400px for office.
  </action>
  <verify>npm run build succeeds. Dev server shows Variance tab with 3 KPIs, 3 variance bar charts, and 50-row event table with color-coded variance values.</verify>
  <done>Variance tab shows: 3 KPI cards with colored percentages, section/client/office variance bar charts with over/under color coding, scrollable 50-event table with formatted dollar amounts and colored variance indicators.</done>
</task>

<task type="auto">
  <name>Task 2: Build Event Manager Performance tab</name>
  <files>src/pages/DashboardPage.tsx</files>
  <action>
Replace the "managers" tab placeholder with the Event Manager Performance view. Use `getManagerData()` data accessor.

**Manager Performance tab content:**

1. **KPI row** (3 cards): Total Managers (count of manager records — 20), Total Events Managed (sum of all eventCount), Average Bid Accuracy (average of all avgBidAccuracy values, formatted as percentage like "104.7%" meaning 4.7% over bid on average).

2. **Manager Leaderboard** — shadcn/ui Table with all 20 managers. Columns:
   - Rank (#)
   - Name
   - Events (eventCount)
   - Total Revenue ($) — formatted with toLocaleString
   - Avg Event Size ($) — formatted
   - Clients Served
   - Recap Events (recapEventCount)
   - Bid Accuracy — display as percentage. Color: values close to 1.0 (1.00-1.03) in `text-emerald-600` (accurate), values > 1.05 in `text-amber-500` (moderate over), values > 1.08 in `text-red-500` (significant over). Use a Badge component for the accuracy value.

3. **Revenue by Manager** — BarChart (vertical) showing totalRevenue per manager, sorted descending. Bar color: chart-1. X-axis: manager names (rotated 45deg for readability). Height: 350px.

4. **Events by Manager** — BarChart (vertical) showing eventCount per manager, sorted descending. Bar color: chart-2. Same layout as revenue chart.

Layout: KPIs across top, full-width leaderboard table, then 2-column grid (revenue chart left, events chart right).

The leaderboard is the primary view here — make it prominent. Add alternating row backgrounds with Tailwind `even:bg-muted/50` for readability. Default sort by eventCount descending (data is already sorted this way).

Add `useState` for a simple sort toggle — allow clicking column headers to sort by that column. Use a basic sort state: `{ key: string, direction: 'asc' | 'desc' }`. Sort the data in render. Keep it simple — no external table library needed.
  </action>
  <verify>npm run build succeeds. Dev server shows Manager Performance tab with 3 KPIs, sortable 20-row manager table, revenue bar chart, events bar chart.</verify>
  <done>Manager Performance tab shows: 3 KPI cards, sortable 20-manager leaderboard with rank/revenue/accuracy columns, bid accuracy color-coded badges, revenue and events bar charts. Column header click sorts ascending/descending.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] `npm run lint` passes (or only pre-existing warnings)
- [ ] All 4 dashboard tabs fully functional (Executive Summary, Cost Analysis, Variance, Managers)
- [ ] Variance tab: 3 KPIs, 3 bar charts with over/under coloring, 50-row event table
- [ ] Manager tab: 3 KPIs, sortable leaderboard, 2 bar charts
- [ ] Tab switching works correctly across all 4 tabs
- [ ] No console errors in browser
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript errors
- All 4 dashboard tabs operational — Historical Intelligence Dashboard complete
- Variance color coding (red/green) consistent throughout Variance tab
- Manager leaderboard sortable by clicking column headers
  </success_criteria>

<output>
After completion, create `.planning/phases/02-dashboard-rate-card/02-02-SUMMARY.md`
</output>
