# Codebase Structure

**Analysis Date:** 2026-02-08

## Directory Layout

```
Event_History/
├── download_estimates.py          # Stage 1: Download XLSX files from URLs
├── catalog_estimates.py           # Stage 2: Scan file structure patterns
├── extract_estimates.py           # Stage 3: Detailed 5-phase extraction
├── rescan_and_enrich.py           # Stage 4: Master integration & enrichment
│
├── DriveShop_Project_List.xlsx    # INPUT: Master project list with URLs
├── historical_estimates/          # DATA: 1,703 downloaded XLSX files
│
├── enriched_master_index.json     # OUTPUT: Master dataset (12 MB)
├── project_list_parsed.json       # OUTPUT: Parsed project metadata (1.8 MB)
├── inventory_report.json          # OUTPUT: Initial structure scan (13 MB)
├── rate_card_master.json          # OUTPUT: Labor roles & rates
├── section_summary.json           # OUTPUT: Section usage stats
├── financial_summary.json         # OUTPUT: Aggregate financials
├── format_examples.json           # OUTPUT: Format distribution
├── summary_report.json            # OUTPUT: High-level stats
├── join_report.json               # OUTPUT: Join statistics
│
├── download_errors.log            # LOG: Download failures
├── catalog_errors.log             # LOG: Cataloging errors
├── extract_errors.log             # LOG: Extraction errors
├── rescan_errors.log              # LOG: Enrichment errors
│
├── .planning/                     # Planning documents (GSD system)
│   └── codebase/                  # Codebase analysis documents
│
└── .git/                          # Version control
```

## Directory Purposes

**Project Root:**
- Purpose: Contains all Python scripts, input files, and output files
- Contains: 4 Python scripts, 1 XLSX input, ~10 JSON outputs, 4 error logs
- Key files: `rescan_and_enrich.py` (most comprehensive script), `enriched_master_index.json` (primary output)

**historical_estimates/:**
- Purpose: Storage for downloaded XLSX estimate files
- Contains: 1,703 `.xlsx` files (automotive event estimates)
- Key info: Files have varied naming (event names, dates, brands)
- Size: ~2 GB total

**.planning/:**
- Purpose: Project planning and codebase analysis documents
- Contains: GSD planning system files
- Subdirectories: `codebase/` for analysis documents

## Key File Locations

**Entry Points:**
- `download_estimates.py` - Stage 1: Download phase
- `catalog_estimates.py` - Stage 2: Catalog/discovery phase
- `extract_estimates.py` - Stage 3: Detailed extraction phase
- `rescan_and_enrich.py` - Stage 4: Master integration phase

**Configuration:**
- Constants defined at top of each Python script (no separate config files)
- `DriveShop_Project_List.xlsx` - Master data source with URLs and project metadata

**Core Logic:**
- `extract_estimates.py` - Format detection, metadata/financial/section/role extraction
- `rescan_and_enrich.py` - Corrected extraction, project metadata join, rate card generation

**Primary Outputs:**
- `enriched_master_index.json` - Complete merged dataset (master output)
- `rate_card_master.json` - Labor role rates and GL codes
- `financial_summary.json` - Aggregate financial data
- `section_summary.json` - Cost section statistics

**Testing:**
- No test files exist

**Documentation:**
- No formal documentation files (documented in MEMORY.md and inline docstrings)

## Naming Conventions

**Files:**
- `snake_case.py` for Python scripts (e.g., `download_estimates.py`, `rescan_and_enrich.py`)
- `snake_case.json` for output data (e.g., `enriched_master_index.json`, `rate_card_master.json`)
- `snake_case.log` for error logs (e.g., `extract_errors.log`)

**Directories:**
- `snake_case` for directories (e.g., `historical_estimates`)

**Special Patterns:**
- `*_estimates.py` for pipeline scripts
- `*_errors.log` for error output per script
- `*_report.json` / `*_summary.json` / `*_master.json` for output data

## Where to Add New Code

**New Pipeline Stage:**
- Primary code: Root directory (new `.py` file following `action_noun.py` pattern)
- Output: Root directory (new `.json` file)
- Error log: Root directory (new `*_errors.log` file)

**Shared Utilities:**
- Currently: Duplicated in each script (no shared module)
- Recommended: Create `utils.py` in root for `sf()`, `ss()`, `load_sheet_grid()`

**New Data Output:**
- Location: Root directory
- Pattern: `descriptive_name.json`

## Special Directories

**historical_estimates/:**
- Purpose: Downloaded data (1,703 XLSX files)
- Source: Generated by `download_estimates.py`
- Committed: Should NOT be committed (large binary files)

**.planning/:**
- Purpose: Project planning documents
- Source: Generated by GSD planning system
- Committed: Yes

---

*Structure analysis: 2026-02-08*
*Update when directory structure changes*
